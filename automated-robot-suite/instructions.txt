chmod +x cloudlab-setup-ubuntu-tl.sh && ./cloudlab-setup-ubuntu-tl.sh && \
sudo apt-get install libvirt-bin genisoimage libguestfs-tools libosinfo-bin virtinst qemu-kvm git vim net-tools wget curl bash-completion python-pip libvirt-daemon-system virt-manager bridge-utils libnss-libvirt libvirt-clients osinfo-db-tools intltool sshpass ca-certificates make nmap dnsmasq-base ebtables libvirt-bin libvirt-dev libxml2-dev libxslt-dev qemu ruby-dev unzip cpu-checker zlib1g-dev build-essential qemu-utils rsync ssh jq python-pip python-dev python3-dev python3-venv virtualenv htop expect ovmf -y && \
sudo sed -i 's/hosts:          files dns/hosts:          files libvirt libvirt_guest dns/' /etc/nsswitch.conf && sudo lsmod | grep kvm && sudo reboot
#sudo systemctl restart libvirtd && sudo systemctl status libvirtd

screen
# Press Return to continue
# detach from session without killing it: Ctrl a d 
# to see screen sessions: screen -ls
# detach from closed session: screen -d -r 2026.pts-0.node0
# enter session: screen -r 2026.pts-0.node0
# exit a session and terminate it: exit

sudo -i
cd /mnt/extra && cat /sys/module/kvm_intel/parameters/nested && cat /proc/cpuinfo | awk '/^processor/{print $3}' | wc -l && free -h && df -hT && sudo virsh list --all && sudo brctl show

# Create the iason user
sudo useradd iason -m -s /bin/bash && sudo usermod -aG sudo iason && echo "iason:iason" | chpasswd && echo "iason ALL=(root) NOPASSWD:ALL" | sudo tee -a /etc/sudoers.d/iason && \
sudo chmod 0440 /etc/sudoers.d/iason && su - iason

# Prepare the hypervisor node.
mkdir .ssh && ssh-keygen -q -t rsa -N "" -f .ssh/id_rsa && cat .ssh/id_rsa.pub >> .ssh/authorized_keys && sudo bash -c "cat .ssh/id_rsa.pub >> /root/.ssh/authorized_keys" && \
ssh -o "StrictHostKeyChecking=no" root@127.0.0.1 uname -a

# http://www.nimbusproject.org/docs/current/admin/z2c/vmm-setup.html
sudo adduser `id -un` libvirt-qemu && sudo adduser `id -un` kvm && sudo adduser `id -un` libvirt-dnsmasq && sudo sed -i 's/0770/0777/' /etc/libvirt/libvirtd.conf && sudo systemctl restart libvirtd && sudo systemctl status libvirtd

# virsh pool-edit default 
# Change permission to: 0777
# sudo systemctl restart libvirtd && sudo systemctl status libvirtd

exit

su - iason

# https://ericho.github.io/2019-09-12-deploy-virtual-starlingx/

git clone https://github.com/vpasias/stx-test.git && cd stx-test/automated-robot-suite/

sudo pip install virtualenvwrapper

which virtualenvwrapper.sh
# /usr/local/bin/virtualenvwrapper.sh

nano ~/.bashrc
# Add to the end of the file

export WORKON_HOME=$HOME/.virtualenvs
export PROJECT_HOME=$HOME/projects
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python
export VIRTUALENVWRAPPER_VIRTUALENV=/usr/local/bin/virtualenv
export VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'
source /usr/local/bin/virtualenvwrapper.sh
export PYTHONPATH="${PYTHONPATH}:/home/iason/stx-test/automated-robot-suite"
#

source ~/.bashrc

wget http://mirror.starlingx.cengn.ca/mirror/starlingx/release/4.0.1/centos/flock/outputs/iso/bootimage.iso

wget -O stx-openstack.tgz http://mirror.starlingx.cengn.ca/mirror/starlingx/release/4.0.1/centos/flock/outputs/helm-charts/stx-openstack-1.0-49-centos-stable-versioned.tgz

virtualenv -p python3 my-venv
source my-venv/bin/activate
pip install -r requirements.txt
pip install -r test-requirements.txt

python runner.py --run-suite Setup --configuration 4 --environment virtual

python runner.py --run-suite Provision

python runner.py --run-suite Sanity-Test
